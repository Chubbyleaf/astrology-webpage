<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./src/style/explore.css" />
    <title>✨古诗词星空探索</title>

    <script src="./Star.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.staticfile.org/element-ui/2.15.9/theme-chalk/index.css"
    />
    <style>
      #app {
        display: flex;
        height: 100vh;
      }

      .el-container {
        color: white;
        background: transparent;
      }

      #content {
        flex: 1;
        padding: 20px;
      }
      #starBg {
        display: block;
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: absolute;
        z-index: 3;
      }
    </style>
  </head>

  <body style="background-color: black">
    <div id="app">
      <el-container>
        <el-header>唐 诗 星 空</el-header>
        <el-container>
          <el-aside width="25%">
            <div class="sidebar-above-div">
              <div class="sidebar-title-div">
                <div>选择您想查看的星象</div>
              </div>
              <el-button type="info" @click="createStars()">查看</el-button>

              <el-cascader v-model="value" :options="options" :props="props" />
            </div>

            <div class="sidebar-below-div">
              <div class="sidebar-title-div">
                <div>详细信息</div>
              </div>
              <div class="poetry-content-div">
                <p><strong>{{poetry.title}}</strong></p>
                <p style="font-size: small">{{poetry.author}}</p>
                <p style="font-size: small">{{poetry.content}}</p>
                <p><strong>体裁:</strong> {{poetry.genre}}</p>
                <p><strong>星宿名:</strong> {{poetry.keyword}}</p>
                <p><strong>情感:</strong> {{poetry.keyword}}</p>
                <p><strong>入诗手法:</strong> {{poetry.keyword}}</p>
              </div>
            </div>
          </el-aside>
          <el-main id="main"> </el-main>
        </el-container>
      </el-container>
    </div>
  </body>

  <script src="https://cdn.staticfile.org/vue/2.6.14/vue.min.js"></script>
  <script src="https://cdn.staticfile.org/element-ui/2.15.9/index.min.js"></script>
  <script type="module">
    import poetryArray from "/src/data/data.js";
    let v = new Vue({
      el: "#app",
      data: function () {
        return {
          sidebarWidth: "25%", // sidebar宽度
          isSidebarCollapsed: false, //左侧sidebar显示状态
          poetry: {
            title: "",
            author: "",
            genre: "",
            keyword: "",
            content: "",
            emotion: "",
            method: "",
          },
          props: {
            multiple: true,
            expandTrigger: "hover",
          },
          value: "", //用户选择的查看的星宿
          options: [
            {
              value: "张",
              label: "张",
              children: [
                {
                  value: "张宿",
                  label: "张宿",
                },
                {
                  value: "鸟嗉",
                  label: "鸟嗉",
                },
                {
                  value: "鹑尾",
                  label: "鹑尾",
                },
                {
                  value: "天庙",
                  label: "天庙",
                },
              ],
            },
            {
              value: "土星",
              label: "土星",
              children: [
                {
                  value: "土星",
                  label: "土星",
                },
                {
                  value: "镇星",
                  label: "镇星",
                },
                {
                  value: "土精",
                  label: "土精",
                },
                {
                  value: "填星",
                  label: "填星",
                },
                {
                  value: "信星",
                  label: "信星",
                },
                {
                  value: "地候",
                  label: "地候",
                },
              ],
            },
          ],
        };
      },
      methods: {
        handleSelect(key, keyPath) {
          console.log(key);
        },
        //左边选择框隐藏/显示
        toggleSidebar() {
          this.isSidebarCollapsed = !this.isSidebarCollapsed;
          this.sidebarWidth = this.isSidebarCollapsed ? "0" : "25%";
        },
        //获取星星出现的位置
        getRandomPosition() {
          const mainElement = document.getElementById("main");
          const mainRect = mainElement.getBoundingClientRect();
          const x = mainRect.left + Math.random() * (mainRect.width - 100);
          const y = mainRect.top + Math.random() * (mainRect.height - 100);
          return { x, y };
        },
        createStar(p) {
          const star = document.createElement("div");
          star.className = "star";
          const { x, y } = this.getRandomPosition();
          star.style.left = `${x}px`;
          star.style.top = `${y}px`;
          const svg = document.createElement("img");
          svg.src = "/src/icon/star.svg";
          svg.alt = "star-svg";
          // svg.style.width = "10px"; // 设置缩小后的宽度
          // svg.style.height = "10px"; // 设置缩小后的高度
          svg.classList.add("star-animation");

          const animationDuration = Math.random() * 5 + 2;
          const animationDelay = Math.random();
          svg.style.animationDuration = `${animationDuration}s`;
          svg.style.animationDelay = `-${animationDelay}s`;

          //添加点击效果
          star.addEventListener("click", () => {
            this.poetry = {
              title: p.title,
              author: p.author,
              genre: p.genre,
              keyword: p.keyword,
              content: p.content,
              emotion: p.emotion,
              method: p.method,
            };
          });

          //添加悬浮效果
          const infoBox = document.createElement("div");
          infoBox.className = "info-box";
          infoBox.innerHTML = `<p>${p.title}</p>`;
          star.appendChild(infoBox);
          star.appendChild(svg);
          document.getElementById("main").appendChild(star);

          //动画最后的效果
          void star.offsetWidth;
          svg.style.opacity = 1;
          // 随机设置星星的大小，最大50px，最小25px
          const starSize = Math.floor(Math.random() * (50 - 25 + 1)) + 25;
          svg.style.width = `${starSize}px`;
          svg.style.height = `${starSize}px`;
        },
        createStars() {
          const existingStars = document.querySelectorAll(".star");
          existingStars.forEach((star) => star.remove());
          poetryArray.forEach(this.createStar);
        },
      },
    });
  </script>
</html>
